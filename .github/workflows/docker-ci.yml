name: Docker Test

on: [push, pull_request]

jobs:
  test:
    runs-on: ubuntu-latest
    
    steps:
    - uses: actions/checkout@v4
    
    - name: Ensure docker-compose.yml exists
      run: |
        # Create if missing
        if [ ! -f "docker-compose.yml" ]; then
          echo 'services:
  web:
    build: .
    ports:
      - "8080:8000"' > docker-compose.yml
        fi
        
        # Show it
        cat docker-compose.yml
    
    - name: Run Docker Compose
      run: |
        docker compose version
        docker compose build
        docker compose up -d
        sleep 10
        curl -f http://localhost:8080
        docker compose down